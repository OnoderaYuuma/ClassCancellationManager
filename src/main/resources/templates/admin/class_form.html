<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>授業情報追加</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-5">
    <h2>授業情報追加</h2>

    <form th:action="@{/admin/classes}" th:object="${classForm}" method="post">
        <!-- classes テーブル関連 -->
        <div class.mb-3>
            <label for="className" class="form-label">授業名</label>
            <input type="text" id="className" th:field="*{className}" class="form-control" required>
        </div>

        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="courseRuleId" class="form-label">学則科目名</label>
                <select id="courseRuleId" th:field="*{courseRuleId}" class="form-select" required>
                    <option value="">選択してください</option>
                    <option th:each="rule : ${courseRules}" th:value="${rule.courseRuleId}" th:text="${rule.courseRuleName}"></option>
                </select>
            </div>
            <div class="col-md-6 mb-3">
                <label for="termId" class="form-label">開講予定期</label>
                <select id="termId" th:field="*{termId}" class="form-select" required>
                    <option value="">選択してください</option>
                    <option th:each="term : ${terms}" th:value="${term.termId}" th:text="${term.termName}"></option>
                </select>
            </div>
        </div>

        <div class="row">
            <div class="col-md-4 mb-3">
                <label for="creditHours" class="form-label">単位時間数</label>
                <input type="number" id="creditHours" th:field="*{creditHours}" class="form-control" required min="1">
            </div>
            <div class="col-md-4 mb-3">
                <label for="academicYear" class="form-label">開講年度</label>
                <input type="number" id="academicYear" th:field="*{academicYear}" class="form-control" required min="2020">
            </div>
            <div class="col-md-4 mb-3">
                <label for="recommendedGrade" class="form-label">推奨学年</label>
                <select id="recommendedGrade" th:field="*{recommendedGrade}" class="form-select" required>
                    <option value="">選択してください</option>
                    <option th:each="grade : ${#numbers.sequence(1, 4)}" th:value="${grade}" th:text="${grade} + '年生'"></option>
                </select>
            </div>
        </div>

        <hr>

        <!-- class_schedules テーブル関連 -->
        <h4>授業スケジュール</h4>
        <div id="schedules-container">
            <!-- JavaScriptで動的に追加 -->
        </div>
        <button type="button" id="add-schedule-btn" class="btn btn-outline-primary mt-2">＋ スケジュールを追加</button>

        <hr>

        <button type="submit" class="btn btn-primary">登録</button>
        <a href="/admin/events" class="btn btn-secondary">キャンセル</a>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const container = document.getElementById('schedules-container');
        const addBtn = document.getElementById('add-schedule-btn');
        let scheduleIndex = 0;

        function addSchedule() {
            const scheduleDiv = document.createElement('div');
            scheduleDiv.classList.add('row', 'align-items-center', 'mb-2', 'schedule-item');

            scheduleDiv.innerHTML = `
                <div class="col-md-5">
                    <label class="form-label">曜日</label>
                    <select name="schedules[${scheduleIndex}].dayOfWeek" class="form-select" required>
                        <option value="MONDAY">月曜日</option>
                        <option value="TUESDAY">火曜日</option>
                        <option value="WEDNESDAY">水曜日</option>
                        <option value="THURSDAY">木曜日</option>
                        <option value="FRIDAY">金曜日</option>
                    </select>
                </div>
                <div class="col-md-5">
                    <label class="form-label">コマ</label>
                    <select name="schedules[${scheduleIndex}].period" class="form-select" required>
                        <option value="1">1限</option>
                        <option value="2">2限</option>
                        <option value="3">3限</option>
                        <option value="4">4限</option>
                    </select>
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="button" class="btn btn-danger remove-schedule-btn">削除</button>
                </div>
            `;

            container.appendChild(scheduleDiv);
            scheduleIndex++;
        }

        addBtn.addEventListener('click', addSchedule);

        container.addEventListener('click', function (e) {
            if (e.target && e.target.classList.contains('remove-schedule-btn')) {
                e.target.closest('.schedule-item').remove();
            }
        });

        // 初期状態で1つ表示
        addSchedule();
    });
</script>

</body>
</html>
